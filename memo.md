1.
OCamlとかいう誰も知らない言語 というタイトルをwikiに書いていたところ,
指導教員と上司に見つかってしまいました, こんばんは taisei という者です
こういうタイトルなんですけれど、想定聴衆は OCaml を書いたことある人です

2.
新入生がどれくらい居るのかよく分かってませんけれど、知らない人も居ると思うので
軽く自己紹介します. 確か39代の副会長で, 京大で純粋培養されて
今だに京都で学生気分をやっております
競プロ勢でCTFもちょっとやってましたが、もう忘れてしまったかもしれないです
後はまぁ、10年以上EXVSってゲームをやってるんですが、治安の悪いゲームとして有名で
他の人はプレイヤーが右下の漫画みたいに見えるらしいですね

3.
なんか知らないけれどここ数年ずっと OCaml を書いてるんですが、
いくつかのプロダクトのコードを見てると知らない記述なんかがチラホラあって、
OCaml ってこんなん書けるんだーってなったわけですが、
今回はその中であんまり知られてなさそうな言語機能をいくつか紹介しようと思います

4.
そもそも OCaml とは Objective Caml の略で, 関数型言語に数えられがちな
プログラミング言語です. 
Caml は Categorical Abstract Machine Language の略で,
ざっくりいうとラムダ計算のような体系を記述する言語のことになるんですかね
なんとか Meta Language のことだと思ってたんですが, CAM Language で区切るっぽいですね
なんとか Meta Language ではないですが Meta Language の方言です
Machine Learning ではないですよ
計算機科学コースの人は3回の実験で使うので必修なので、書いたことある人が多いとは思います
知らない人は参照に貼ったサイトを見て入門してください


5.
一応なんも知らん人向けに申し訳程度のフォローをしておくと、こんな感じの言語です
この例では point というレコード型, shape というバリアント型を定義し,
pi というfloat型の定数を定義し,
area という面積を求める関数を定義しています.
float_of_int というのは int を float に変換する関数です

6.
もう一個, module を使う例を適当に上げておきます. これは List という module で
a list 型を Nil か Cons の再帰多相バリアントとして定義し,
map というリスト内の要素を変換する関数を定義しています.
この例のmap は末尾再帰になっていないのでこんなの書いたらボコボコのボコですけれどね
そしてint型listの各要素を二倍にする関数はこんな感じで書けます

7.
さてOCamlについて軽く復習したところで,今回はここにあげた機能について触れます.
15分くらい立ったら適当に切るかもしれませんが、全部独立した話なのでまぁ大丈夫でしょう

8.
まずは Extensible Variant Type です
これはヴァリアント型をこんな感じで .. と記述すると,
後から t のコンストラクタを追加できるという機能です
この例では t 型に Str と Int と Float を追加してます

9.
結構激しい仕様だと思うんですけれどユースケースはあって, 例えば Result モナド,
Haskell だと Either モナドですか, の Error.t 型としてよく用いられます.
出得る Error って module 毎に違うので Error moduleの中で網羅しておくのは難しいし
見通しが良くならないと思うんですが,
このエラーが他所でも追加できることで, result モナドの型を統一しつつも
エラーの処理は各所で宣言して処理するみたいなことができます
パターンマッチするときはもちろん網羅することはできないので,
エラーを出さないようにするには必然的にワイルドパターンが必要になりますね

10.
次に, Polymorphic Variant です
これは定義無しで使えるコンストラクタです タグと呼ばれてます
普通のコンストラクタと違うのは, 先頭がバッククォートで始まる点,
型に属さない特殊な扱いがされている点,
関数の引数等になると取りうるタグの集合がそのまま型として現れる点でしょうかね
型には属さないので型宣言はいりませんが, 同じ記法ですが型注釈を付けることはできて,
パターンマッチでちょっと楽できたりします.

11.
関数定義した場合の型ですが, 取りうるタグの集合は関数内で出てきたものに収まるとは
限らないので、型に大なり小なりが現れてきます.
これはタグのスーパーセットやサブセットを表しています

12.
次に Monadic Bind です
これまでocamlでモナドを扱おうとすると...


13.
これは let の後に記号をつけたものを演算子として定義すると、
特殊な感じで展開されるという機能です. and も同様に定義できます.


